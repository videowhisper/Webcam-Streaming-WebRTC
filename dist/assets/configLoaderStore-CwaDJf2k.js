import{u as d}from"./index-8TFUJpWm.js";function g(n=3){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(;i.length<n;)i+=r.charAt(Math.floor(Math.random()*r.length));return i}function u(n){return new URLSearchParams(window.location.search).get(n)}let c=null;function w(){const n=d.getState();return n.configLoaded&&n.config?Promise.resolve(n.config):c||(c=(async()=>{try{const r=(window==null?void 0:window.videowhisperConfig)||{},i=["./config.json","./unconfigured.json"];let a=null,s=null;for(const o of i)try{const t=r.configUrl||o,l=await fetch(t);if(l.ok){a=await l.json(),s=o;break}}catch{console.log(`Config file ${o} not found, trying next option...`)}if(!a){const o="Failed to load any config file";throw console.error(o),n.setConfigError(o),new Error(o)}const e={...a,...r,configSource:s};if(n.setDevMode(!!e.development),e.deny)return console.error("Configuration denied:",e.deny),n.setConfig({...e,error:e.deny}),n.setView("Denied"),e;if(e.enableGET){const o=u("view"),t=u("channel");o&&(e.view=o),t&&(e.channel=t)}const f=n.config||{};if((!e.channel||e.channel==="{generate}")&&(e.channel=f.channel||"Room"+g(4)),!e.username||e.username==="{generate}"){const o=(e.view||"User")+g(3)+"_";e.username=f.username||o+e.channel}if(!e.channel||!e.username){const o="Invalid configuration: missing channel or username";throw console.error(o,e),n.setConfigError(o),n.setView("Error"),new Error(o)}return n.configLoaded&&n.config?n.config:(n.setConfig(e),n.currentView!==(e.view||"Broadcast")&&n.setView(e.view||"Broadcast"),e)}catch(r){throw console.error("Error loading config:",r),n.setConfigError(r.message||"Unknown configuration error"),n.setView("Error"),c=null,r}})(),c)}export{w as loadConfigIntoStore};
