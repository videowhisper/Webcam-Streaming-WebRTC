import{u as g}from"./index-C9M2rMoT.js";function l(n=3){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(;t.length<n;)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function f(n){return new URLSearchParams(window.location.search).get(n)}async function d(){const n=g.getState();try{const r=(window==null?void 0:window.videowhisperConfig)||{},t=["./config.json","./unconfigured.json"];let s=null,c=null;for(const o of t)try{const i=r.configUrl||o,a=await fetch(i);if(a.ok){s=await a.json(),c=o;break}}catch{console.log(`Config file ${o} not found, trying next option...`)}if(!s){const o="Failed to load any config file";return console.error(o),n.setConfigError(o),null}const e={...s,...r,configSource:c};if(e.development===!0?n.setDevMode(!0):n.setDevMode(!1),e.deny)return console.error("Configuration denied:",e.deny),n.setConfig({...e,error:e.deny}),n.setView("Denied"),e;if(e.enableGET){const o=f("view"),i=f("channel");o&&(e.view=o),i&&(e.channel=i)}if((!e.channel||e.channel==="{generate}")&&(e.channel="Room"+l(4)),!e.username||e.username==="{generate}"){const o=(e.view||"User")+l(3)+"_";e.username=o+e.channel}if(!e.channel||!e.username){const o="Invalid configuration: missing channel or username";return console.error(o,e),n.setConfigError(o),n.setView("Error"),null}return n.setConfig(e),n.setView(e.view||"Broadcast"),e}catch(r){return console.error("Error loading config:",r),n.setConfigError(r.message||"Unknown configuration error"),n.setView("Error"),null}}export{d as loadConfigIntoStore};
